<!-- Faraday Penetration Test IDE -->
<!-- Copyright (C) 2013  Infobyte LLC (http://www.infobytesec.com/) -->
<!-- See the file 'doc/LICENSE' for the license information -->

<section id="main" class="status-report seccion clearfix">
  <div class="faraday-header-border-fix"></div>
    <div class="right-main">
		<div ng-controller="headerCtrl" ng-include="'scripts/commons/partials/header.html'"></div>
        <div id="reports-main" class="fila clearfix">
            <div class="button-control col-md-12 col-sm-12 col-xs-12" id="btn_bar">
                <div class="control-wrapper control-new">
                    <button type="button" class="btn btn-success btn-new" title="{{workspaceData.readonly == true ? 'Read-only. Workspace disabled': 'New Vulns'}}"  ng-click="new()" ng-disabled="workspaceData.readonly == true">
                        New
                    </button>
                </div>
                <div class="control-wrapper control-edit">
                    <button type="button" class="btn btn-default edit" title="{{workspaceData.readonly == true ? 'Read-only. Workspace disabled': 'Edit selected vulns'}}" ng-click="edit()" ng-disabled="getCurrentSelection().length != 1">
                        <img src="images/icon-toolbar-edit.svg" class="edit-icon" />
                    </button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="SingleActions" ng-show="getCurrentSelection().length === 1"  ng-disabled="workspaceData.readonly == true">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                        <li><a class="ws" ng-click="saveAsModel()">Create template</a></li>
                        <li><a class="ws" ng-click="showExploits()">Search exploits</a></li>
                    </ul>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Actions" ng-hide="getCurrentSelection().length < 2" ng-disabled="workspaceData.readonly == true">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu" ng-show="getCurrentSelection().length >= 2">
                        <li><a class="ws" ng-click="editString('name')">Edit name</a></li>
                        <li><a class="ws" ng-click="editText('desc', 'description')">Edit description</a></li>
                        <li><a class="ws" ng-click="editText('data')">Edit data</a></li>
                        <li><a class="ws" ng-click="editText('resolution')">Edit resolution</a></li>
                        <li><a class="ws" ng-click="editSeverity()">Edit severity</a></li>
                        <li><a class="ws" ng-click="editEaseofresolution()">Edit ease of resolution</a></li>
                        <li><a class="ws" ng-click="editReferences()">Add references</a></li>
                        <li><a class="ws" ng-click="editImpact()">Edit impact</a></li>
                        <li><a class="ws" ng-click="editStatus()">Edit status</a></li>
                        <li><a class="ws" ng-click="editPolicyviolations()">Edit policy violations</a></li>
                        <li><a class="ws" ng-click="editConfirm()">Confirm/Change to false positive</a></li>
                        <li ng-show="vulnWebSelected" role="separator" class="divider"></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('method')">Edit method</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('pname', 'param name')">Edit param name</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('params', 'parameters')">Edit parameters</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('path')">Edit path</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('query')">Edit query</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editString('website')">Edit website</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editText('request')">Edit request</a></li>
                        <li ng-show="vulnWebSelected"><a class="ws" ng-click="editText('response')">Edit response</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a class="ws" ng-click="editCWE()">From vulnerability template</a></li>
                        <li><a class="ws" ng-click="saveAsModel()">Create vulnerability templates</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a class="ws" ng-click="showExploits()">Search exploits</a></li>
                    </ul>
                </div>
                <div class="control-wrapper">
                    <button type="button" class="btn btn-default" title="{{workspaceData.readonly == true? 'Read-only. Workspace disabled': 'Delete selected items'}}" ng-click="delete()" ng-disabled="workspaceData.readonly == true">
                        <img src="images/icon-toolbar-delete.svg" class="delete-icon" />
                    </button>
                </div>
                <div class="control-wrapper search-wrapper">
                    <form role="form" ng-submit="searchFor(true, searchParams)" title="The search expression can't contain parentheses that are not closed, double quotes that are not closed, or double spaces.">
                        <div class="form-group" ng-class="{'has-error':!isValidExpression(searchParams)}">
                            <div class="input-group">
                                <span class="input-group-addon glyphicon-btn glyphicon glyphicon-remove" ng-click="searchFor(false, '')" ng-if="searchParams !== '' || (search && search != 'confirmed=true')"></span>
                                <input type="text" class="form-control" placeholder="Enter keywords" ng-change="currentPage = 1" ng-model="searchParams" />
                                <span class="input-group-addon glyphicon-btn" ng-click="searchFor(true, searchParams)" ng-disabled="!isValidExpression(searchParams)">
                                    <img src="images/icon-toolbar-searchbar-loupe.svg" class="search-icon" />
                                </span>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="control-wrapper download-wrapper">
                    <button file-exporter="csv()" type="button" class="btn btn-default" title="Download CSV for current workspace">
                        <img src="images/icon-toolbar-download.svg" class="download-icon" />
                    </button>
                </div>
                <div class="control-wrapper download-wrapper" ng-hide="fileUploadEnabled === true">
                    <button ng-click="enableFileUpload()" type="button" class="btn btn-default" title="{{workspaceData.readonly == true ? 'Read-only. Workspace disabled': 'Upload a report'}}" ng-disabled="workspaceData.readonly == true">
                        <img src="images/icon-toolbar-upload.svg"/>
                    </button>
                </div>
                <div class="pl" ng-show="fileUploadEnabled === true">
                    <span class="file-container">
                        <button ng-if="fileToUpload === undefined" type="button" class="btn btn-success btn-labeled no-border-radius">
                            <span class="btn-label"><i class="fa fa-upload"></i>
                        </span>Select file</button>
                        <input type="file" file-model="fileToUpload" ng-class="{'file-selected': fileToUpload !== undefined}">
                    </span>
                    <span ng-if="fileToUpload !== undefined">
                        <button type="button" class="btn btn-success btn-labeled no-border-radius" title="Upload selected file" ng-click="uploadFile()">
                            <span class="btn-label"><i class="fa fa-upload"></i>
                        </span>Upload file</button>
                        <p class="file-name">{{fileToUpload.name}}</p>
                    </span>
                </div>
                <div class="space-wrapper"></div>
                <div class="control-wrapper control-wrap-right">
                    <div class="btn-group">
                        <button type="button" ng-if="propertyGroupBy" class="btn btn-danger" title="Clear" ng-click="clearGroupBy()">
                            <i class="fa fa-times"></i>
                        </button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="{{propertyGroupBy || 'Group By'}}">
                            {{ (propertyGroupBy | uppercase) || "Group By"}}
                        </button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Group By">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            <li ng-repeat="(column, show) in columns">
                                <a class="ws" ng-show="show && (column !== 'evidence' && column !== 'impact' && column !== 'web' && column !== 'easeofresolution' && column !== 'date')" ng-click="groupBy(column)">{{column}}</a>
                            </li>
                        </ul>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="{{propertyFilterConfirmed}}">
                            {{ (propertyFilterConfirmed) }}
                        </button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Filter confirmed vulns">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            <li>
                                <a class="ws" ng-if="propertyFilterConfirmed !== 'All'" ng-click="filterConfirmed('All')">All</a>
                                <a class="ws" ng-if="propertyFilterConfirmed !== 'Confirmed'"  ng-click="filterConfirmed('Confirmed')">Confirmed</a>
                                <a class="ws" ng-if="propertyFilterConfirmed !== 'Unconfirmed'" ng-click="filterConfirmed('Unconfirmed')">Unconfirmed</a>
                            </li>
                        </ul>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Add columns">
                            Add columns
                        </button>
                        <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" title="Add Columns">
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-right" role="menu">
                            <li ng-repeat="(column, show) in columns">
                                <a class="ws" ng-click="toggleShow(column, show)" ng-show="!show">{{column}}</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="reports col-md-12 col-sm-12 col-xs-12">
                <i ng-if="loading" class="fa fa-spinner fa-spin loading-spinner"></i>
                <div ui-grid="gridOptions" ui-grid-grouping ui-grid-selection ui-grid-pagination ui-grid-pinning ui-grid-resize-columns class="grid status-report-grid" ng-style="{'height' : gridHeight }"></div>

                <div id="counter">
                    <span>Total</span>
                    <span class="counterNum">{{gridOptions.totalItems}}</span>
                    <div ng-if="search">
                        <span>Viewing</span>
                        <span class="counterNum">{{gridOptions.data.length}}</span>
                    </div>
                    <p style="margin:0px" ng-if="!search"></p>
                    <span>Selected</span>
                    <span class="counterNum">{{getCurrentSelection().length}}</span>
                </div>
            </div>
            <!-- .reports -->
        </div>
        <!-- #reports-main -->

        <div id="vuln-preview">
            <div class="preview-header">
                <!--<span class="prev-header-id preview-tag">ID: {{lastClickedVuln._id}}</span>-->
                <!--<span class="prev-header-id preview-tag">{{lastClickedVuln.target}}</span>-->
                <!--<span class="prev-header-id preview-tag" ng-if="lastClickedVuln.type !== 'VulnerabilityWeb'">Vulnerability</span>-->
                <!--<span class="prev-header-id preview-tag" ng-if="lastClickedVuln.type === 'VulnerabilityWeb'">Web vulnerability</span>-->
                <button type="button" class="close" ng-click="hideVulnPreview()" data-dismiss="alert"><span area-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>

            <!--<div class="preview-section">-->
                <!--<div ng-if="fieldToEdit !== 'name'">-->
                    <!--<div class="col-md-10">-->
                        <!--<div class="tab-pane-header">{{lastClickedVuln.name}}</div>-->
                    <!--</div>-->
                    <!--<div class="col-md-2">-->
                        <!--<span class="preview-icon" ng-click="activeEditPreview('name')"><i class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group" ng-if="fieldToEdit === 'name'">-->
                    <!--<label for="inp-edit-name"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true"></i>    Vulnerability name</label>-->
                    <!--<input type="text" class="form-control" id="inp-edit-name"-->
                               <!--ng-model="lastClickedVuln.name" name="name" placeholder="Vulnerability name"-->
                               <!--ng-blur="processToEditPreview()"-->
                               <!--autofocus required>-->
                <!--</div>-->
            <!--</div>-->


            <!--<div class="preview-section">-->
                <!--<div style="margin-bottom: 50px">-->
                    <!--<div class="btn-group col-md-6">-->
                    <!--<button type="button" class="dropdown-toggle btn-change-property primary-btn"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="btn-chg-severity-prev"-->
                            <!--title="{{lastClickedVuln.severity}}">-->
                        <!--<i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'severity'"></i>  {{lastClickedVuln.severity | uppercase}}-->
                    <!--</button>-->
                    <!--<button type="button" class="dropdown-toggle secondary-btn btn-change-property"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="caret-chg-severity-prev"-->
                            <!--title="Change severity">-->
                        <!--<span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>-->
                    <!--</button>-->
                    <!--<ul class="dropdown-menu dropdown-menu-right" role="menu">-->
                        <!--<li>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('unclassified')">UNCLASSIFIED</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('info')">INFO</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('low')">LOW</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('med')">MEDIUM</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('high')">HIGH</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeSeverity('critical')">CRITICAL</a>-->
                        <!--</li>-->
                    <!--</ul>-->
                <!--</div>-->

                    <!--<div class="btn-group col-md-6">-->
                    <!--<button type="button" class="dropdown-toggle btn-change-property primary-btn btn-primary-white"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="btn-chg-ease_resolution-prev"-->
                            <!--title="{{lastClickedVuln.easeofresolution}}">-->
                        <!--<i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'easeofresolution'"></i> {{lastClickedVuln.easeofresolution || "Ease of Resolution"}}-->
                    <!--</button>-->
                    <!--<button type="button" class="dropdown-toggle secondary-btn btn-change-property btn-secondary-white"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="caret-ease_resolution-prev"-->
                            <!--title="Change Ease of Resolution">-->
                        <!--<span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>-->
                    <!--</button>-->
                    <!--<ul class="dropdown-menu dropdown-menu-right" role="menu">-->
                        <!--<li>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution(null)">Undetermined</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution('trivial')">Trivial</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution('simple')">Simple</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution('moderate')">Moderate</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution('difficult')">Difficult</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeEaseOfResolution('infeasible')">Infeasible</a>-->
                        <!--</li>-->
                    <!--</ul>-->
                <!--</div>-->
                <!--</div>-->

                <!--<div>-->
                    <!--<div class="btn-group col-md-6">-->
                        <!--<button type="button" class="dropdown-toggle btn-change-property primary-btn text-capitalize"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="btn-chg-status-prev"-->
                            <!--title="{{lastClickedVuln.status}}">-->
                        <!--<i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'status'"></i>{{lastClickedVuln.status  || "Status"}}-->
                    <!--</button>-->
                        <!--<button type="button" class="dropdown-toggle secondary-btn btn-change-property"-->
                            <!--data-toggle="dropdown"-->
                            <!--id="caret-chg-status-prev"-->
                            <!--title="Change Status">-->
                        <!--<span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>-->
                    <!--</button>-->
                        <!--<ul class="dropdown-menu dropdown-menu-right" role="menu">-->
                        <!--<li>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeStatus('opened')">Opened</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeStatus('closed')">Closed</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeStatus('re-opened')">Re-opened</a>-->
                            <!--<a class="ws"-->
                               <!--ng-click="changeStatus('risk-accepted')">Risk-accepted</a>-->
                        <!--</li>-->
                    <!--</ul>-->
                    <!--</div>-->

                    <!--<div class="col-md-6">-->
                    <!--<label class="chbox-container">-->
                        <!--<div class="tab-pane-header"><h4>Confirmed</h4></div>-->
                        <!--<input type="checkbox" ng-checked="lastClickedVuln.confirmed === true"  ng-model="lastClickedVuln.confirmed" ng-change="changeConfirmed(lastClickedVuln.confirmed)">-->
                        <!--<span class="checkmark"></span>-->
                    <!--</label>-->
                <!--</div>-->

                <!--</div>-->
            <!--</div>-->

            <!--<div class="preview-section row">-->
                <!--<div ng-if="fieldToEdit !== 'desc'">-->
                    <!--<div class="col-md-10">-->
                        <!--<div class="tab-pane-header" title="{{lastClickedVuln.desc.length > 450 ? lastClickedVuln.desc:''}}">{{lastClickedVuln.desc | limitTo:450 }} <span ng-if="lastClickedVuln.desc.length > 450">...</span></div>-->
                    <!--</div>-->
                    <!--<div class="col-md-2">-->
                        <!--<span class="preview-icon" ng-click="activeEditPreview('desc')"><i class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group" ng-if="fieldToEdit === 'desc'">-->
                    <!--<label for="inp-edit-desc"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true"></i>    Vulnerability description</label>-->
                    <!--<textarea type="text" class="form-control" id="inp-edit-desc" rows="5"-->
                               <!--ng-model="lastClickedVuln.desc" name="desc" placeholder="Vulnerability description"-->
                               <!--ng-blur="processToEditPreview()"-->
                              <!--autofocus></textarea>-->
                <!--</div>-->

            <!--</div>-->


            <!--<div class="preview-section row">-->
                <!--<div class="col-md-12" title="{{lastClickedVuln.hostnames.length > 3 ? lastClickedVuln.hostnames.join('\n'):''}}">-->
                        <!--<div class="tab-pane-header">Hostnames:</div>-->
                        <!--<div class="tab-pane-header" ng-repeat="hostname in lastClickedVuln.hostnames | limitTo:3">-->
                            <!--<i class="fa fa-desktop"></i>   &nbsp;  {{hostname}}-->
                        <!--</div>-->
                        <!--<div class="tab-pane-header" ng-if="lastClickedVuln.hostnames.length > 3"><i class="fa fa-desktop"></i>   &nbsp;    ...</div>-->
                <!--</div>-->
            <!--</div>-->

            <!--<div class="preview-section">-->
                <!--<div class="col-md-12 margin-bottom-15px">-->
                        <!--<div class="tab-pane-header"><label for="inp-edit-desc"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'impact'"></i>  Impact</div>-->
                        <!--<h4><span ng-repeat="(key, value) in lastClickedVuln.impact" class="normal-size"-->
                                  <!--style="cursor: pointer;">-->
                        <!--<span ng-class="{'label-impact label-default-impact': !value, 'label-impact label-success-impact': value}"-->
                              <!--ng-click="toggleImpact(key)">{{key}}</span>-->
                        <!--</span></h4>&lt;!&ndash; .normal-size &ndash;&gt;-->
                <!--</div>-->
            <!--</div>-->



            <div class="mt-3">
            <!--<div class="modal-data-name" ng-init="isNameEditable = false">-->
                <!--<div ng-if="isNameEditable == false && lastClickedVuln.name !== undefined">-->
                    <!--<span class="data-name">{{lastClickedVuln.name}}</span>-->
                    <!--<span class="edit-name-icon" ng-click="isNameEditable = true"><i-->
                            <!--class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>-->
                <!--</div>-->

                <!--<div ng-if="isNameEditable == true || lastClickedVuln.name == undefined">-->
                    <!--<div class="form-group" ng-class="{'has-error': formEdit.name.$invalid }">-->
                        <!--<label class="sr-only" for="inp-edit-name">Vuln name</label>-->
                        <!--<input type="text" class="form-control" id="inp-edit-name"-->
                               <!--ng-model="lastClickedVuln.name" name="name" placeholder="Vuln name"-->
                               <!--ng-blur="isNameEditable = lastClickedVuln.name == undefined "-->
                               <!--autofocus required>-->
                    <!--</div>-->
                <!--</div>-->
            <!--</div>-->
            <div class="row">
                <div ng-if="fieldToEdit !== 'name'">
                    <div class="col-md-6 " style="margin-bottom: 24px">
                        <div class="tab-pane-header">
                            {{lastClickedVuln.name}}
                            <span class="preview-icon" ng-click="activeEditPreview('name')"><i class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>
                        </div>
                    </div>
                </div>
                <div class="form-group col-md-6" ng-if="fieldToEdit === 'name'" style="margin-bottom: 24px">
                    <label for="inp-edit-name"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true"></i>    Vulnerability name</label>
                    <input type="text" class="form-control" id="inp-edit-name"
                               ng-model="lastClickedVuln.name" name="name" placeholder="Vulnerability name"
                               ng-blur="processToEditPreview()"
                               autofocus required>
                </div>
            </div>

            <div class="edit-vulns-dropdowns row" ng-init="updateBtnSeverityColor(lastClickedVuln.severity);updateBtnStatusColor(lastClickedVuln.status)">

                <div class="btn-group col-md-3 col-sm-6 col-xs-6">
                    <button type="button" class="dropdown-toggle btn-change-property primary-btn"
                            data-toggle="dropdown"
                            id="btn-chg-severity-prev"
                            title="{{lastClickedVuln.severity}}">
                        <i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'severity'"></i>{{lastClickedVuln.severity | uppercase}}
                    </button>
                    <button type="button" class="dropdown-toggle secondary-btn btn-change-property"
                            data-toggle="dropdown"
                            id="caret-chg-severity-prev"
                            title="Change severity-prev">
                        <span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                        <li>
                            <a class="ws"
                               ng-click="changeSeverity('unclassified')">UNCLASSIFIED</a>
                            <a class="ws"
                               ng-click="changeSeverity('info')">INFO</a>
                            <a class="ws"
                               ng-click="changeSeverity('low')">LOW</a>
                            <a class="ws"
                               ng-click="changeSeverity('med')">MEDIUM</a>
                            <a class="ws"
                               ng-click="changeSeverity('high')">HIGH</a>
                            <a class="ws"
                               ng-click="changeSeverity('critical')">CRITICAL</a>
                        </li>
                    </ul>
                </div>


                <div class="btn-group col-md-3 col-sm-6 col-xs-6">
                    <button type="button" class="dropdown-toggle btn-change-property primary-btn btn-primary-white"
                            data-toggle="dropdown"
                            id="btn-chg-ease_resolution"
                            title="{{lastClickedVuln.easeofresolution}}">
                        <i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'easeofresolution'"></i>{{lastClickedVuln.easeofresolution || "Ease of Resolution"}}
                    </button>
                    <button type="button" class="dropdown-toggle secondary-btn btn-change-property btn-secondary-white"
                            data-toggle="dropdown"
                            id="caret-ease_resolution"
                            title="Change Ease of Resolution">
                        <span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                        <li>
                             <a class="ws"
                               ng-click="changeEaseOfResolution(null)">Undetermined</a>
                            <a class="ws"
                               ng-click="changeEaseOfResolution('trivial')">Trivial</a>
                            <a class="ws"
                               ng-click="changeEaseOfResolution('simple')">Simple</a>
                            <a class="ws"
                               ng-click="changeEaseOfResolution('moderate')">Moderate</a>
                            <a class="ws"
                               ng-click="changeEaseOfResolution('difficult')">Difficult</a>
                            <a class="ws"
                               ng-click="changeEaseOfResolution('infeasible')">Infeasible</a>
                        </li>
                    </ul>
                </div>


                <div class="btn-group col-md-3 col-sm-6 col-xs-6">
                    <button type="button" class="dropdown-toggle btn-change-property primary-btn text-capitalize"
                            data-toggle="dropdown"
                            id="btn-chg-status-prev"
                            title="{{lastClickedVuln.status}}">
                        <i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'status'"></i>{{lastClickedVuln.status  || "Status"}}
                    </button>
                    <button type="button" class="dropdown-toggle secondary-btn btn-change-property"
                            data-toggle="dropdown"
                            id="caret-chg-status-prev"
                            title="Change Status">
                        <span> <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> </span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right" role="menu">
                        <li>
                            <a class="ws"
                               ng-click="changeStatus('opened')">Opened</a>
                            <a class="ws"
                               ng-click="changeStatus('closed')">Closed</a>
                            <a class="ws"
                               ng-click="changeStatus('re-opened')">Re-opened</a>
                            <a class="ws"
                               ng-click="changeStatus('risk-accepted')">Risk-accepted</a>
                        </li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6 col-xs-6">
                    <label class="chbox-container">
                        <div class="tab-pane-header"><h4>Confirmed</h4></div>
                        <input type="checkbox"  ng-checked="lastClickedVuln.confirmed === true"  ng-model="lastClickedVuln.confirmed" ng-change="changeConfirmed(lastClickedVuln.confirmed)">
                        <span class="checkmark"></span>
                    </label>
                </div>

            </div>


            <!-- Nav tabs -->
            <ul class="nav nav-tabs" id="nav-tabs-container">
                <li class="nav-item active" ng-class="{'has-error': formEdit.desc.$invalid}">
                    <a class="nav-link active" data-toggle="tab" data-target="#general"
                       href="javascript:;">General</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" data-target="#technical_details" href="javascript:;">Technical
                        Details</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" data-target="#tab-evidence" href="javascript:;">Evidence</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" data-target="#tab-custom-fields" href="javascript:;">Custom Fields</a>
                </li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div id="general" class="container tab-pane-container tab-pane active"><br>
                    <div class="col-md-6">
                        <div class="col-md-12">
                            <div class="tab-pane-header">
                                <i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'template'"></i>
                                Search vulnerability database templates
                                <a
                                        href="https://github.com/infobyte/faraday/wiki/vulnerabilities-database"
                                        target="_blank"><span class="glyphicon glyphicon-question-sign"
                                                              title="Read more about vulnerability templates in the official Faraday Documentation"></span></a>
                            </div>
                            <div class="form-group col-md-12 prev-apply-template" ng-class="{'active': cweList.indexOf(cwe_selected) > -1}">
                                <input type="text" ng-model="cwe_selected" class="form-control input-sm" style="margin-left:-15px"
                                       placeholder="Search for vulnerability templates"
                                       uib-typeahead="cwe as cwe.name for cwe in cweList | filter:{name: $viewValue} | limitTo:10"
                                       typeahead-on-select="populate()">
                            </div>

                            <div class="col-md-3" ng-if="cweList.indexOf(cwe_selected) > -1">
                                <span class="btn btn-success input-sm" style="margin-left: 35px" ng-click="applyTemplate()" title="Apply template"><i class="fa fa-check"></i></span>
                                <span class="btn btn-default input-sm" title="Discard changes" ng-click="discardTemplate()"><i class="fa fa-reply"></i></span>
                            </div>
                        </div>

                        <div class="col-md-12 custom-divider"></div>

                        <div class="col-md-12">
                            <div ng-if="fieldToEdit !== 'desc'" class="pretty-text">
                                <div class="col-md-10 margin-bottom-24">
                                    <div ng-if="lastClickedVuln.desc === '' || lastClickedVuln.desc === undefined"  style="margin-bottom: 15px;color: #aaa;">
                                        <p>
                                            No Description was found.
                                        </p>
                                    </div>
                                    <div class="tab-pane-header" id="desc-prev" title="{{lastClickedVuln.desc.length > 450 ? lastClickedVuln.desc:''}}" >
                                        <span ng-bind-html="lastClickedVuln.desc | limitTo: 450"> </span>
                                        <span class="tab-pane-header" ng-if="lastClickedVuln.desc.length > 450">...</span>
                                    </div>

                                </div>
                                <div class="col-md-2">
                                    <span class="preview-icon" title="Edit Description" ng-click="activeEditPreview('desc')"><i class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>
                                </div>
                            </div>
                            <div class="form-group" ng-if="fieldToEdit === 'desc'">
                                <label for="inp-edit-desc"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true"></i>    Description</label>
                                <textarea type="text" class="form-control" id="inp-edit-desc" rows="5"
                                          ng-model="lastClickedVuln.desc" name="desc" placeholder="Description"
                                          ng-blur="processToEditPreview()"
                                          autofocus>
                                </textarea>
                            </div>
                        </div>

                        <div class="form-group margin-top-22px">
                        <div class="show-scroll col-md-12">
                            <div class="col-md-12">
                                <div class="tab-pane-header"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true && fieldToEdit === 'refs'"></i>  References</div>
                                <div class="input-group margin-bottom-sm">
                                    <label class="sr-only" for="vuln-refs">References</label>
                                    <input type="text" class="form-control" id="vuln-refs" placeholder="Reference"
                                           ng-model="new_ref"/>
                                    <span class="input-group-addon cursor" ng-click="newReference()"><i
                                            class="fa fa-plus-circle"></i></span>
                                </div>
                            </div>
                            <div class="col-md-12 reference" ng-repeat="reference in lastClickedVuln.refs">
                                <div class="input-group margin-bottom-sm">
                                    <label class="sr-only" for="vuln-refs-create">References</label>
                                    <input type="text" class="form-control" id="vuln-refs-create" placeholder="Reference"
                                           ng-model="reference" ng-click="openReference(reference)"
                                           role="button"
                                           readonly/>
                                    <span class="input-group-addon cursor" ng-click="removeReference($index)"><i
                                            class="fa fa-minus-circle"></i></span>
                                </div>
                            </div>
                        </div><!-- .form-group -->
                    </div>
                    </div>


                    <div class="col-md-6">
                        <div class="row">
                            <div ng-if="fieldToEdit !== 'resolution'" class="pretty-text">
                                <div class="col-md-10 margin-bottom-24">
                                    <div ng-if="lastClickedVuln.resolution === '' || lastClickedVuln.resolution === undefined"  style="margin-bottom: 15px;color: #aaa;">
                                        <p>
                                            No Resolution was found.
                                        </p>
                                    </div>
                                    <div class="tab-pane-header" id="resolution-prev" title="{{lastClickedVuln.resolution.length > 450 ? lastClickedVuln.resolution:''}}" >
                                        <span ng-bind-html="lastClickedVuln.resolution | limitTo: 450"> </span>
                                        <span class="tab-pane-header" ng-if="lastClickedVuln.resolution.length > 450">...</span>
                                    </div>

                                </div>
                                <div class="col-md-2">
                                    <span class="preview-icon" title="Edit Resolution" ng-click="activeEditPreview('resolution')"><i class="fa fa-pencil fa-lg" aria-hidden="true"></i></span>
                                </div>
                            </div>
                            <div class="form-group" ng-if="fieldToEdit === 'resolution'">
                                <label for="inp-edit-desc"><i class="fa fa-spinner fa-spin" ng-show="isUpdatingVuln === true"></i>    Resolution</label>
                                <textarea type="text" class="form-control" id="inp-edit-res" rows="5"
                                          ng-model="lastClickedVuln.resolution" name="desc" placeholder="Resolution"
                                          ng-blur="processToEditPreview(false)"
                                          autofocus>
                                </textarea>
                            </div>
                        </div>

                        <div class="form-group margin-top-22px">
                        <div class="col-md-12">
                            <div class="tab-pane-header">Policy Violations</div>
                            <div class="input-group margin-bottom-sm">
                                <label class="sr-only" for="vuln-policyviolations">Policy Violations</label>
                                <input type="text" class="form-control" id="vuln-policyviolations"
                                       placeholder="Policy Violations" ng-model="modal.new_policyviolation"/>
                                <span class="input-group-addon cursor" ng-click="modal.newPolicyViolation()"><i
                                        class="fa fa-plus-circle"></i></span>
                            </div>
                        </div>
                        <div class="col-md-12 reference" ng-repeat="policyviolation in lastClickedVuln.policyviolations">
                            <div class="input-group margin-bottom-sm">
                                <label class="sr-only" for="vuln-policyviolations-value">Policy Violation</label>
                                <input type="text" class="form-control" id="vuln-policyviolations-value"
                                       placeholder="Policy Violation" ng-model="policyviolation.value" disabled/>
                                <span class="input-group-addon cursor"
                                      ng-click="lastClickedVuln.policyviolations.splice($index, 1)"><i
                                        class="fa fa-minus-circle"></i></span>
                            </div>
                        </div>
                    </div><!-- .form-group -->

                        <div class="col-md-12 margin-bottom-15px margin-top-22px">
                        <div class="tab-pane-header">Impact</div>
                        <h4><span ng-repeat="(key, value) in lastClickedVuln.impact" class="normal-size"
                                  style="cursor: pointer;">
                        <span ng-class="{'label-impact label-default-impact': !value, 'label-impact label-success-impact': value}"
                              ng-click="modal.toggleImpact(key)">{{key}}</span>
                        </span></h4><!-- .normal-size -->
                    </div>
                    </div>

                </div>
                <div id="technical_details" class="container tab-pane-container tab-pane fade"><br>
                    <div class="col-md-12">
                        <div class="tab-pane-header">Data</div>
                        <div class="form-group">
                            <label class="sr-only" for="vuln-data">Vuln data</label>
                            <textarea class="form-control" id="vuln-data" rows="5"
                                      ng-model="lastClickedVuln.data" placeholder="Data"></textarea>
                        </div><!-- .form-group -->
                    </div>

                    <div class="col-md-6 col-sm-12 col-xs-12" ng-show="lastClickedVuln.type === 'VulnerabilityWeb'">
                        <div class="tab-pane-header">Request</div>
                        <div class="form-group">
                            <label class="sr-only" for="vuln-request">Vuln request</label>
                            <textarea class="form-control" id="vuln-request" rows="8"
                                      ng-model="lastClickedVuln.request" placeholder="Request"></textarea>
                        </div><!-- .form-group -->
                    </div>

                    <div class="col-md-6 col-sm-12 col-xs-12" ng-show="lastClickedVuln.type === 'VulnerabilityWeb'">
                        <div class="tab-pane-header">Response</div>
                        <div class="form-group">
                            <label class="sr-only" for="vuln-response">Vuln response</label>
                            <textarea class="form-control" id="vuln-response" rows="8"
                                      ng-model="lastClickedVuln.response" placeholder="Response"></textarea>
                        </div><!-- .form-group -->
                    </div>

                    <div class="margin-top-22px" ng-show="lastClickedVuln.type === 'VulnerabilityWeb'">
                        <div class="col-md-4">
                            <div class="tab-pane-header">Method</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-method">Method</label>
                                <input type="text" class="form-control" id="vuln-method" placeholder="Method"
                                       ng-model="lastClickedVuln.method"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-3">
                            <div class="tab-pane-header">Param Name</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-pname">Param Name</label>
                                <input type="text" class="form-control" id="vuln-pname" placeholder="Param name"
                                       ng-model="lastClickedVuln.pname"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-5">
                            <div class="tab-pane-header">Params</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-params">Params</label>
                                <input type="text" class="form-control" id="vuln-params" placeholder="Params"
                                       ng-model="lastClickedVuln.params"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-3">
                            <div class="tab-pane-header">Path</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-path">Path</label>
                                <input type="text" class="form-control" id="vuln-path" placeholder="Path"
                                       ng-model="lastClickedVuln.path"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-2">
                            <div class="tab-pane-header">Status code</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-path">Status code</label>
                                <input type="text" class="form-control" id="vuln-status-code" placeholder="Status code"
                                       ng-model="lastClickedVuln.status_code"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-3">
                            <div class="tab-pane-header">Query</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-query">Query</label>
                                <input type="text" class="form-control" id="vuln-query" placeholder="Query"
                                       ng-model="lastClickedVuln.query"/>
                            </div><!-- .form-group -->
                        </div>

                        <div class="col-md-4">
                            <div class="tab-pane-header">Website</div>
                            <div class="form-group">
                                <label class="sr-only control-label" for="vuln-website">Website</label>
                                <input type="text" class="form-control" id="vuln-website" placeholder="Website"
                                       ng-model="lastClickedVuln.website"/>
                            </div><!-- .form-group -->
                        </div>
                    </div>
                </div>
                <div id="tab-evidence" class="container tab-pane fade"><br>
                    <div class="col-md-12 margin-bottom-15px">
                        <div class="tab-pane-header">Evidence</div>
                        <div class="alert alert-danger normal-size" role="alert" ng-if="modal.file_name_error">
                            <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                            <span class="sr-only">Error:</span>
                            Cannot upload evidence starting with underscore, please choose a different name for the
                            file.
                        </div>
                        <div class="form-group normal-size">
                            <input type="file" id="evidence" ng-file-select ng-multiple="true" resetOnClick="false"
                                   ng-file-change="modal.selectedFiles($files, $event)"/>
                            <p class="help-block">Multiple files are allowed.</p>
                        </div><!-- .form-group -->
                        <div id="evidenceFiles" class="normal-size" ng-if="lastClickedVuln._attachments">
                            <ul>
                                <li ng-repeat="(name, file) in lastClickedVuln._attachments">
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-default"
                                                ng-click="modal.openEvidence(name)">
                                            <span class="fa {{icons[name]}}"
                                                  title="Evidence {{name | decodeURIComponent}}"></span> {{name |
                                            decodeURIComponent}}
                                        </button><!-- ng-repeat -->
                                        <button type="button" class="btn btn-danger"
                                                ng-click="modal.removeEvidence(name)">
                                            <span class="glyphicon glyphicon-trash"></span>
                                        </button>
                                    </div>
                                </li>
                            </ul>
                        </div><!-- #evidenceFiles -->
                    </div>

                </div>

                <div id="tab-custom-fields" class="container tab-pane-container tab-pane fade"><br>
                    <div ng-if="modal.customFields.length === 0" class="no-info-overlay" style="margin-bottom: 15px;">
                            <p class="no-info-text">
                                No custom fields were found. To create one refer to our
                                <a href="https://github.com/infobyte/faraday/wiki/Custom-Fields" target="_blank">wiki page</a>.
                            </p>
                    </div>
                    <div class="col-md-12 margin-bottom-15px">
                        <div class="col-md-12" ng-repeat="cf in modal.customFields | orderBy : 'field_order'">
                        <custom-field field="{{cf}}"></custom-field>
                    </div>

                </div>
            </div>
        </div>



        </div>
    </div>
    </div>
    <!-- .right-main -->
</section>
<!-- #main -->
